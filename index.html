<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Pipstagram</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
.hidden{display:none}
header{padding:10px;border-bottom:1px solid #222;display:flex;justify-content:space-between}
nav{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;background:#000;border-top:1px solid #222}
nav button{background:none;border:none;color:white;font-size:22px}
section{padding:15px;padding-bottom:80px}
input,button{padding:10px;margin:5px;border-radius:6px;border:none}
button{background:#0095f6;color:white}
.user{padding:10px;border-bottom:1px solid #222}
.reel{height:70vh;background:#111;margin-bottom:20px;display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <h2>ğŸ“¸ Pipstagram</h2>
  <input id="email" placeholder="E-posta">
  <input id="pass" type="password" placeholder="Åifre">
  <button onclick="register()">Kaydol</button>
  <button onclick="login()">GiriÅŸ</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
  <b>Pipstagram</b>
  <span onclick="show('dm')">ğŸ’¬</span>
</header>

<section id="home">
  <h3>Ana Sayfa</h3>
</section>

<section id="search" class="hidden">
  <input id="searchName" placeholder="KullanÄ±cÄ± adÄ±">
  <button onclick="searchUser()">Ara</button>
  <div id="searchResult"></div>
</section>

<section id="reels" class="hidden">
  <input type="file" id="reelFile">
  <button onclick="uploadReel()">Reels YÃ¼kle</button>
  <div id="reelList"></div>
</section>

<section id="dm" class="hidden">
  <h3>DM</h3>
  <input id="dmTo" placeholder="Kime (uid)">
  <input id="dmText" placeholder="Mesaj">
  <button onclick="sendDM()">GÃ¶nder</button>
  <div id="messages"></div>
</section>

<section id="profile" class="hidden">
  <h3>Profil</h3>
  <p id="uidText"></p>
</section>

<nav>
  <button onclick="show('home')">ğŸ </button>
  <button onclick="show('search')">ğŸ”</button>
  <button onclick="show('reels')">ğŸ¬</button>
  <button onclick="show('dm')">ğŸ’¬</button>
  <button onclick="show('profile')">ğŸ‘¤</button>
</nav>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCWmJVnZ4LIB07cPM8t_Run-1indRrDm9s",
  authDomain: "pipstagram-5b98e.firebaseapp.com",
  projectId: "pipstagram-5b98e"
});

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

function show(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function register(){
  auth.createUserWithEmailAndPassword(email.value, pass.value)
    .then(u=>{
      db.collection("users").doc(u.user.uid).set({
        username: email.value.split("@")[0]
      });
    })
    .catch(e=>alert(e.message));
}

function login(){
  auth.signInWithEmailAndPassword(email.value, pass.value)
    .catch(e=>alert(e.message));
}

auth.onAuthStateChanged(u=>{
  if(u){
    login.classList.add("hidden");
    app.classList.remove("hidden");
    uidText.innerText = "UID: " + u.uid;
  }
});

/* 1ï¸âƒ£ ARAMA */
function searchUser(){
  db.collection("users")
    .where("username","==",searchName.value)
    .get().then(s=>{
      searchResult.innerHTML="";
      s.forEach(d=>{
        searchResult.innerHTML += `<div class="user">${d.data().username}
        <button onclick="follow('${d.id}')">Takip Et</button></div>`;
      });
    });
}

/* 2ï¸âƒ£ TAKÄ°P */
function follow(uid){
  db.collection("follows").add({
    from: auth.currentUser.uid,
    to: uid
  });
  alert("Takip edildi");
}

/* 3ï¸âƒ£ DM */
function sendDM(){
  db.collection("dm").add({
    from: auth.currentUser.uid,
    to: dmTo.value,
    text: dmText.value,
    time: Date.now()
  });
}

db.collection("dm").onSnapshot(s=>{
  messages.innerHTML="";
  s.forEach(d=>{
    messages.innerHTML += `<p>${d.data().text}</p>`;
  });
});

/* 4ï¸âƒ£ REELS */
function uploadReel(){
  const f = reelFile.files[0];
  const ref = storage.ref("reels/"+Date.now()+f.name);
  ref.put(f).then(()=>ref.getDownloadURL().then(url=>{
    db.collection("reels").add({url});
  }));
}

db.collection("reels").onSnapshot(s=>{
  reelList.innerHTML="";
  s.forEach(d=>{
    reelList.innerHTML += `<div class="reel">ğŸ¬</div>`;
  });
});
</script>
</body>
</html>







  











