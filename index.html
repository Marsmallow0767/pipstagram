<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Pipstagram</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#000;color:#fff;font-family:Arial}
.hidden{display:none}
header{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #222}
nav{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;border-top:1px solid #222;background:#000}
nav button{background:none;border:none;color:white;font-size:22px}
section{padding:15px;padding-bottom:80px}
input,button{padding:10px;margin:5px;border-radius:6px;border:none}
button{background:#0095f6;color:white}
.reel{height:90vh;display:flex;align-items:center;justify-content:center;font-size:40px;border-bottom:1px solid #111}
.user{padding:10px;border-bottom:1px solid #222;cursor:pointer}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <h2>ğŸ“¸ Pipstagram</h2>
  <input id="email" placeholder="E-posta">
  <input id="pass" type="password" placeholder="Åifre">
  <button onclick="register()">Kaydol</button>
  <button onclick="loginUser()">GiriÅŸ</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
  <b>Pipstagram</b>
  <span onclick="show('notifications')">ğŸ””</span>
</header>

<section id="home">
  <h3>Ana Sayfa</h3>
</section>

<section id="reels" class="hidden"></section>

<section id="dm" class="hidden">
  <h3>DM</h3>
  <div id="userList"></div>
  <div id="chat" class="hidden">
    <div id="messages"></div>
    <input id="msgText" placeholder="Mesaj">
    <button onclick="sendMessage()">GÃ¶nder</button>
  </div>
</section>

<section id="profile" class="hidden">
  <h3>Profil</h3>
  <p id="myUid"></p>
</section>

<section id="notifications" class="hidden">
  <h3>Bildirimler</h3>
  <div id="notifyList"></div>
</section>

<nav>
  <button onclick="show('home')">ğŸ </button>
  <button onclick="show('reels')">ğŸ¬</button>
  <button onclick="show('dm')">ğŸ’¬</button>
  <button onclick="show('profile')">ğŸ‘¤</button>
</nav>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCWmJVnZ4LIB07cPM8t_Run-1indRrDm9s",
  authDomain: "pipstagram-5b98e.firebaseapp.com",
  projectId: "pipstagram-5b98e"
});

const auth=firebase.auth();
const db=firebase.firestore();
let activeChat=null;

function show(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function register(){
  auth.createUserWithEmailAndPassword(email.value,pass.value)
    .then(r=>db.collection("users").doc(r.user.uid).set({email:email.value}));
}

function loginUser(){
  auth.signInWithEmailAndPassword(email.value,pass.value);
}

auth.onAuthStateChanged(u=>{
  if(u){
    login.classList.add("hidden");
    app.classList.remove("hidden");
    myUid.innerText=u.uid;
    loadUsers();
    loadReels();
    loadNotifications();
  }
});

/* 1ï¸âƒ£ REELS */
function loadReels(){
  db.collection("reels").onSnapshot(s=>{
    reels.innerHTML="";
    s.forEach(d=>reels.innerHTML+=`<div class="reel">ğŸ¬ Reels</div>`);
  });
}

/* 2ï¸âƒ£ DM */
function loadUsers(){
  db.collection("users").onSnapshot(s=>{
    userList.innerHTML="";
    s.forEach(d=>{
      if(d.id!==auth.currentUser.uid)
        userList.innerHTML+=`<div class="user" onclick="openChat('${d.id}')">${d.data().email}</div>`;
    });
  });
}

function openChat(uid){
  activeChat=uid;
  chat.classList.remove("hidden");
  db.collection("dm").where("chat","==",[auth.currentUser.uid,uid].sort().join("_"))
    .onSnapshot(s=>{
      messages.innerHTML="";
      s.forEach(m=>messages.innerHTML+=`<p>${m.data().text}</p>`);
    });
}

function sendMessage(){
  db.collection("dm").add({
    chat:[auth.currentUser.uid,activeChat].sort().join("_"),
    text:msgText.value
  });
}

/* 4ï¸âƒ£ BÄ°LDÄ°RÄ°M */
function loadNotifications(){
  db.collection("notifications")
    .where("to","==",auth.currentUser.uid)
    .onSnapshot(s=>{
      notifyList.innerHTML="";
      s.forEach(n=>notifyList.innerHTML+=`<p>${n.data().text}</p>`);
    });
}
</script>
</body>
</html>








  












