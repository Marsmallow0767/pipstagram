<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Pipstagram DM</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#fff}
header{
  padding:12px;
  border-bottom:1px solid #ddd;
  font-size:20px;
}
#messages{
  height:80vh;
  overflow-y:auto;
  padding:10px;
}
.msg{
  padding:8px 12px;
  margin:5px 0;
  border-radius:12px;
  max-width:70%;
}
.me{background:#dcf8c6;margin-left:auto}
.other{background:#eee}
footer{
  display:flex;
  border-top:1px solid #ddd;
}
input{
  flex:1;
  padding:10px;
  border:none;
}
button{
  padding:10px;
  border:none;
  background:#0095f6;
  color:white;
}
</style>
</head>

<body>

<header>ðŸ“© DM</header>

<div id="messages"></div>

<footer>
  <input id="msg" placeholder="Mesaj yaz...">
  <button onclick="send()">GÃ¶nder</button>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCWmJVnZ4LIB07cPM8t_Run-1indRrDm9s",
  authDomain: "pipstagram-5b98e.firebaseapp.com",
  projectId: "pipstagram-5b98e",
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const uid = localStorage.getItem("uid") || "demo";
const chatWith = "user2"; // test iÃ§in

const messages = document.getElementById("messages");

const q = query(collection(db,"messages"));
onSnapshot(q,snap=>{
  messages.innerHTML="";
  snap.forEach(d=>{
    const m = d.data();
    if(
      (m.from===uid && m.to===chatWith) ||
      (m.from===chatWith && m.to===uid)
    ){
      messages.innerHTML += `
        <div class="msg ${m.from===uid?'me':'other'}">
          ${m.text}
        </div>
      `;
    }
  });
  messages.scrollTop = messages.scrollHeight;
});

window.send = async ()=>{
  if(!msg.value) return;
  await addDoc(collection(db,"messages"),{
    from:uid,
    to:chatWith,
    text:msg.value,
    time:Date.now()
  });
  msg.value="";
};
</script>

</body>
</html>
